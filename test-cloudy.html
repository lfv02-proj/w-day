<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Cloudinary Unsigned Upload – Quick Test</title>
  <style>
    body { font-family: system-ui, Arial; margin: 24px; }
    .row { margin: 12px 0; }
    pre { background: #f6f6f6; padding: 10px; border-radius: 6px; overflow:auto; }
    button { padding: 10px 14px; border: 0; border-radius: 8px; background: #8b5e3c; color: #fff; cursor: pointer; }
    button:hover { background: #70452c; }
  </style>
</head>
<body>
  <h2>Cloudinary Unsigned Upload – Quick Test</h2>
  <div class="row">
    <input id="file" type="file" accept="image/*,video/*">
    <button id="send">Upload</button>
  </div>
  <div class="row"><strong>Status:</strong> <span id="status">Idle</span></div>
  <div class="row"><strong>Result JSON:</strong><pre id="out">{ }</pre></div>

  <script>
    const CLOUD_NAME = "dx6q3zyyh";              // <-- your cloud
    const UPLOAD_PRESET = "wedding_guest_uploads"; // <-- UNSIGNED preset you created
    const FOLDER = "wedding_guests";             // optional

    const fileEl = document.getElementById("file");
    const btn = document.getElementById("send");
    const statusEl = document.getElementById("status");
    const out = document.getElementById("out");

    btn.addEventListener("click", async () => {
      if (!fileEl.files || !fileEl.files[0]) { statusEl.textContent = "Pick a file first"; return; }
      statusEl.textContent = "Uploading…";

      const fd = new FormData();
      fd.append("file", fileEl.files[0]);
      fd.append("upload_preset", UPLOAD_PRESET); // UNSIGNED
      if (FOLDER) fd.append("folder", FOLDER);

      try {
        const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, { method: "POST", body: fd });

        // If Cloudinary rejects (e.g., wrong preset), show the raw response text
        if (!res.ok) {
          const txt = await res.text();
          statusEl.textContent = "Upload failed";
          out.textContent = txt;
          console.error("Cloudinary error:", txt);
          return;
        }

        const json = await res.json();
        statusEl.textContent = json.secure_url ? "Success ✅" : "Uploaded, but no secure_url?";
        out.textContent = JSON.stringify(json, null, 2);
      } catch (e) {
        statusEl.textContent = "Network error";
        out.textContent = String(e);
      }
    });
  </script>
</body>
</html>
